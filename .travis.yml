sudo: false
language: node_js
cache:
  directories:
  - "$HOME/google-cloud-sdk/"
env: 
before_install:
- if [ ! -d ${HOME}/google-cloud-sdk ]; then curl https://sdk.cloud.google.com | bash;
  fi
- tar -xzf credentials.tar.gz
- mkdir -p lib
- gcloud auth activate-service-account --key-file client-secret.json
install:
- gcloud config set project payment-services
- npm install
script:
- gcloud -q preview app deploy app.yaml --promote
- npm test
deploy:
  provider: gcs
  access_key_id: payment-services
  secret_access_key:
    secure: zxZZ4CeuE7yM0npNbR99QYfbC2pjvWdrqybmcpvnl7CR7m3o1YyykQHjKR/Gs51F8nTh5S23F9E7g5IXM4mOHagfxvJ23toH0UFeyQLvmjSnu7cX8p9KnVt8zx3iuyT6Je0qyDK8vEdcFAYjn35anxPTQSWjkyYSD8tDMubwAFgLlqf+hDe3reFfXlO1lDaU3KitPOk9Foi2KmN9JTVZkPRnM4H04hBgVjLXlnnmbsBiqwrBgFENKB97VNEjLqiPzG6lbLH0LZ9TDYEQSPOK0ufEcd92GCAh4jN9f9yx1kf55oS184otOv5SSgHJb6mC9Bqa0BbZY/zjllh7oiDdSoDlQUnDn9bOK9LkffCTlpkyQLSV1zU0s1l+TMR/nPu9cRmyIZKFLxI+fSvK7Pmkgnrd+WTloOX2ILDeNbO2Q8R0PDMOav6K2PlkL06m1j8nmrrohWd1dkYBLEME+NI+IPyYsA+pnRNzkAw4yORgFfBCxdXyr8ic4iWK4Btc5j66laLEO2nOSp4YvxBAOm7t3MPpoc/jDojf+ryogp/W6zY7lEUv28s7AqT8tglijAdTxbUkRx30T4id8UZg+oooafzHN28G4eTmjEy4eH5xsrRGgfWrnU7JKgybTg311IT0rLEJf8gHIEvGUc3oFY45LG6RBGVHlJAuRMfcSGa2RKU=
  bucket: gs://staging.payment-services.appspot.com/
  on:
    repo: viktorRock/payment-services
